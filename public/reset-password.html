<div id="resetPasswordForm">
    <h3>Reset Your Password</h3>
    <form id="resetPassword">
        <input type="password" id="newPassword" placeholder="New Password" required />
        <input type="password" id="confirmPassword" placeholder="Confirm Password" required />
        <button type="submit">Reset Password</button>
    </form>
    <div id="resetPasswordError" style="display: none; color: red;"></div>
    <div id="resetPasswordSuccess" style="display: none; color: green;">Password has been reset successfully!</div>
</div>

<script>
    // Extract the token from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (!token) {
        document.getElementById('resetPasswordError').textContent = 'Invalid or expired token.';
        document.getElementById('resetPasswordError').style.display = 'block';
    }

    // Handle the form submission to reset the password
    document.getElementById('resetPassword').addEventListener('submit', async function (e) {
        e.preventDefault();

        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const resetPasswordError = document.getElementById('resetPasswordError');
        const resetPasswordSuccess = document.getElementById('resetPasswordSuccess');

        // Clear previous messages
        resetPasswordError.style.display = 'none';
        resetPasswordSuccess.style.display = 'none';

        // Check if passwords match
        if (newPassword !== confirmPassword) {
            resetPasswordError.textContent = 'Passwords do not match!';
            resetPasswordError.style.display = 'block';
            return;
        }

        try {
            const response = await fetch('/admin/reset-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token, newPassword }),
            });

            const data = await response.json();

            if (!response.ok) {
                resetPasswordError.textContent = data.error || 'Failed to reset password.';
                resetPasswordError.style.display = 'block';
            } else {
                resetPasswordSuccess.style.display = 'block';
            }
        } catch (error) {
            resetPasswordError.textContent = 'An unexpected error occurred. Please try again.';
            resetPasswordError.style.display = 'block';
        }
    });
</script>
